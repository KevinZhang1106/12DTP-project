<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>

    <link rel="stylesheet" href="/static/home.css">

</head>

<body>

    <nav class="nav-bar">
        <div class="nav-buttons-container">
            <a href="/championranking/0" class="ranking-button">Ranking</a>
            <div class="search-wrapper">
                <input type="text" id="searchbar" placeholder="Search Champions">
                <div class="search-results">
                    {% for champion in searchbar %}
                    <a href="/champions/{{champion[0]}}/{{champion[1]}}" class="champion-link"
                        data-name="{{champion[2].lower()}}">
                        <img src="/static/Images/{{champion[2]}}/icon.png" />
                        {{champion[2]}}
                    </a>
                    {% endfor %}
                    <p id="matches-text">No matches found</p>
                </div>
            </div>
            <button id="update-button">Update Data</button>
        </div>
    </nav>
    <p id="update-status"></p>

    <script>

        const searchbar = document.getElementById("searchbar");
        const links = document.querySelectorAll(".champion-link");
        const matches = document.getElementById("matches-text");

        searchbar.addEventListener("input", function () {
            const searchText = this.value.toLowerCase();
            let hasMatches = false;

            links.forEach(link => {
                const champion = link.getAttribute("data-name");
                if (searchText.length > 0 && champion.startsWith(searchText)) {
                    link.style.display = "block";
                    hasMatches = true;
                } else {
                    link.style.display = "none";
                }
            });

            if (searchText.length > 0 && hasMatches == false) {
                matches.style.display = "block";
            }
            else {
                matches.style.display = "none";
            }
        });


        document.getElementById("update-button").addEventListener("click", () => {
            const password = prompt("Enter the admin password:");

            fetch("/update-data", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ password })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success == true) {
                    window.location.href = "/updatedata";
                } else {
                    const status = document.getElementById("update-status");
                    status.textContent = "Incorrect password.";
                    status.style.color = "red";

                     setTimeout(() => {
                        status.textContent = "";
                        }, 2500);
                }
            })
        });

    </script>


</body>

</html>